<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MacroTrack</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        body {
            background-color: #f8fafc; /* Slate-50 */
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        /* Hide number input arrows */
        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { 
            -webkit-appearance: none; 
            margin: 0; 
        }
        /* Custom scrollbar */
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        
        .pb-safe { padding-bottom: env(safe-area-inset-bottom); }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        const BASE_BURN = 2000; // Default daily burn

        // --- DATA ---
        const FOOD_DATABASE = [
            { id: '1', name: 'Rice (Raw)', unit: 'g', servingSize: 100, calories: 356, protein: 7, carbs: 78, fat: 0.5 },
            { id: '2', name: 'Roti', unit: 'pc', servingSize: 1, calories: 100, protein: 3, carbs: 18, fat: 3 },
            { id: '3', name: 'Moong Dal', unit: 'g', servingSize: 100, calories: 375, protein: 24, carbs: 60, fat: 1.5 },
            { id: '4', name: 'Potatoes', unit: 'g', servingSize: 148, calories: 115, protein: 4, carbs: 26, fat: 0.2 },
            { id: '5', name: 'Milk', unit: 'ml', servingSize: 250, calories: 150, protein: 18, carbs: 12, fat: 5 }, 
            { id: '6', name: 'Whey Protein', unit: 'scoop', servingSize: 1, calories: 120, protein: 24, carbs: 3, fat: 1.5 },
            { id: '7', name: 'Yogurt', unit: 'g', servingSize: 175, calories: 100, protein: 18, carbs: 6, fat: 0 },
            { id: '8', name: 'Veggies (Cauli/Broc)', unit: 'g', servingSize: 100, calories: 30, protein: 2, carbs: 5, fat: 0 },
            { id: '9', name: 'Bread', unit: 'slice', servingSize: 2, calories: 250, protein: 9, carbs: 45, fat: 3 }, 
            { id: '10', name: 'Egg', unit: 'g', servingSize: 100, calories: 145, protein: 12.5, carbs: 1, fat: 10 },
            { id: '11', name: 'Paneer', unit: 'g', servingSize: 55, calories: 130, protein: 7, carbs: 1, fat: 11 },
            { id: '12', name: 'Soya Chunks', unit: 'g', servingSize: 100, calories: 353, protein: 52, carbs: 33, fat: 0.5 },
            { id: '13', name: 'Oil', unit: 'ml', servingSize: 15, calories: 120, protein: 0, carbs: 0, fat: 14 },
            { id: '14', name: 'Onion', unit: 'g', servingSize: 100, calories: 40, protein: 1.1, carbs: 9.3, fat: 0.1 },
            { id: '15', name: 'Tomato', unit: 'g', servingSize: 100, calories: 18, protein: 0.9, carbs: 3.9, fat: 0.2 },
        ];

        // --- ICONS ---
        const Icons = {
            Trash: () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/></svg>,
            Plus: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M5 12h14"/><path d="M12 5v14"/></svg>,
            Utensils: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2"/><path d="M7 2v20"/><path d="M21 15V2v0a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7"/></svg>,
            Scale: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m16 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z"/><path d="m2 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z"/><path d="M7 21h10"/><path d="M12 3v18"/><path d="M3 7h2c2 0 5-1 7-2 2 1 5 2 7 2h2"/></svg>,
            List: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="8" y1="6" x2="21" y2="6"/><line x1="8" y1="12" x2="21" y2="12"/><line x1="8" y1="18" x2="21" y2="18"/><line x1="3" y1="6" x2="3.01" y2="6"/><line x1="3" y1="12" x2="3.01" y2="12"/><line x1="3" y1="18" x2="3.01" y2="18"/></svg>,
            Target: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg>,
            Activity: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg>,
            Calendar: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/></svg>,
            Fire: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z"/></svg>,
        };

        // --- COMPONENTS ---

        const ProgressBar = ({ label, current, max, color, unit = "g" }) => {
            const percentage = Math.min(100, Math.max(0, (current / max) * 100));
            return (
                <div className="mb-3">
                    <div className="flex justify-between text-xs font-medium text-slate-500 mb-1">
                        <span>{label}</span>
                        <span>{Math.round(current)} / {max}{unit}</span>
                    </div>
                    <div className="h-2 w-full bg-slate-100 rounded-full overflow-hidden">
                        <div 
                            className={`h-full ${color} transition-all duration-500 ease-out`}
                            style={{ width: `${percentage}%` }}
                        ></div>
                    </div>
                </div>
            );
        };

        const BottomNav = ({ currentView, setView }) => {
            const navItems = [
                { id: 'track', label: 'Track', icon: Icons.Utensils },
                { id: 'burn', label: 'Burn', icon: Icons.Fire }, // Added Burn
                { id: 'history', label: 'History', icon: Icons.Calendar },
                { id: 'foods', label: 'Foods', icon: Icons.List },
                { id: 'weight', label: 'Weight', icon: Icons.Scale },
                { id: 'goals', label: 'Goals', icon: Icons.Target },
            ];

            return (
                <div className="fixed bottom-0 left-0 right-0 bg-white border-t border-slate-100 pb-safe z-50">
                    <div className="flex justify-around items-center h-16 max-w-md mx-auto">
                        {navItems.map(item => {
                            const isActive = currentView === item.id;
                            const Icon = item.icon;
                            return (
                                <button
                                    key={item.id}
                                    onClick={() => setView(item.id)}
                                    className={`flex flex-col items-center justify-center w-full h-full space-y-1 ${isActive ? 'text-indigo-600' : 'text-slate-400 hover:text-slate-600'}`}
                                >
                                    <Icon />
                                    <span className="text-[10px] font-medium">{item.label}</span>
                                </button>
                            );
                        })}
                    </div>
                </div>
            );
        };

        const App = () => {
            // --- STATE ---
            const [view, setView] = useState('track'); 
            
            // Log Meal State
            const [isCustomFood, setIsCustomFood] = useState(false);
            const [selectedFoodId, setSelectedFoodId] = useState(FOOD_DATABASE[0].id);
            const [amount, setAmount] = useState('');
            const [customFood, setCustomFood] = useState({ name: '', calories: '', protein: '', carbs: '', fat: '' });
            
            // Exercise State
            const [activityName, setActivityName] = useState('');
            const [caloriesBurnt, setCaloriesBurnt] = useState('');

            // Persistent State
            const [logs, setLogs] = useState(() => JSON.parse(localStorage.getItem('diet_logs') || '[]'));
            const [exercises, setExercises] = useState(() => JSON.parse(localStorage.getItem('exercise_logs') || '[]'));
            const [weights, setWeights] = useState(() => JSON.parse(localStorage.getItem('weight_logs') || '[]'));
            const [goals, setGoals] = useState(() => JSON.parse(localStorage.getItem('diet_goals') || JSON.stringify({
                calories: 2000,
                protein: 150,
                carbs: 250,
                fat: 60
            })));

            const [currentWeight, setCurrentWeight] = useState('');

            // --- EFFECTS ---
            useEffect(() => localStorage.setItem('diet_logs', JSON.stringify(logs)), [logs]);
            useEffect(() => localStorage.setItem('exercise_logs', JSON.stringify(exercises)), [exercises]);
            useEffect(() => localStorage.setItem('weight_logs', JSON.stringify(weights)), [weights]);
            useEffect(() => localStorage.setItem('diet_goals', JSON.stringify(goals)), [goals]);

            // --- HELPERS ---
            const getLocalISODate = () => {
                const d = new Date();
                const year = d.getFullYear();
                const month = String(d.getMonth() + 1).padStart(2, '0');
                const day = String(d.getDate()).padStart(2, '0');
                return `${year}-${month}-${day}`;
            };

            // --- COMPUTED ---
            const todayLogs = useMemo(() => {
                const today = getLocalISODate();
                return logs.filter(log => log.date === today);
            }, [logs]);

            const todayExercises = useMemo(() => {
                const today = getLocalISODate();
                return exercises.filter(ex => ex.date === today);
            }, [exercises]);

            const totals = useMemo(() => {
                const foodTotals = todayLogs.reduce((acc, log) => ({
                    calories: acc.calories + log.calories,
                    protein: acc.protein + log.protein,
                    carbs: acc.carbs + log.carbs,
                    fat: acc.fat + log.fat,
                }), { calories: 0, protein: 0, carbs: 0, fat: 0 });

                // Calculate total burnt calories: BASE_BURN + exercises
                const burntTotal = todayExercises.reduce((acc, ex) => acc + ex.calories, BASE_BURN);

                return { ...foodTotals, burnt: burntTotal };
            }, [todayLogs, todayExercises]);

            const selectedFood = FOOD_DATABASE.find(f => f.id === selectedFoodId);
            const todayDateDisplay = getLocalISODate();

            // --- HANDLERS ---
            const handleAddFood = (e) => {
                e.preventDefault();
                let newLog;

                if (isCustomFood) {
                    if (!customFood.name || !customFood.calories) return;
                    newLog = {
                        id: Date.now(),
                        date: getLocalISODate(),
                        foodName: customFood.name,
                        unit: 'srv',
                        amount: 1,
                        calories: parseInt(customFood.calories) || 0,
                        protein: parseFloat(customFood.protein) || 0,
                        carbs: parseFloat(customFood.carbs) || 0,
                        fat: parseFloat(customFood.fat) || 0,
                        isCustom: true
                    };
                    setCustomFood({ name: '', calories: '', protein: '', carbs: '', fat: '' });
                } else {
                    if (!amount || amount <= 0) return;
                    const food = FOOD_DATABASE.find(f => f.id === selectedFoodId);
                    const ratio = parseFloat(amount) / food.servingSize;
                    newLog = {
                        id: Date.now(),
                        date: getLocalISODate(),
                        foodName: food.name,
                        unit: food.unit,
                        amount: parseFloat(amount),
                        calories: Math.round(food.calories * ratio),
                        protein: parseFloat((food.protein * ratio).toFixed(1)),
                        carbs: parseFloat((food.carbs * ratio).toFixed(1)),
                        fat: parseFloat((food.fat * ratio).toFixed(1)),
                    };
                    setAmount('');
                }
                setLogs([newLog, ...logs]);
            };

            const handleAddExercise = (e) => {
                e.preventDefault();
                if (!activityName || !caloriesBurnt) return;

                const newExercise = {
                    id: Date.now(),
                    date: getLocalISODate(),
                    name: activityName,
                    calories: parseInt(caloriesBurnt)
                };

                setExercises([newExercise, ...exercises]);
                setActivityName('');
                setCaloriesBurnt('');
            };

            const handleAddWeight = (e) => {
                e.preventDefault();
                if (!currentWeight) return;
                const newWeight = { id: Date.now(), date: new Date().toLocaleDateString(), weight: parseFloat(currentWeight) };
                setWeights([newWeight, ...weights]);
                setCurrentWeight('');
            };

            return (
                <div className="max-w-md mx-auto min-h-screen flex flex-col relative">
                    {/* Header */}
                    <header className="bg-white p-5 pt-8 sticky top-0 z-10 border-b border-slate-100 flex justify-between items-center">
                        <div className="flex items-center gap-1">
                            <h1 className="text-2xl font-black text-indigo-700 tracking-tight">MacroTrack</h1>
                        </div>
                        <div className="bg-slate-100 px-3 py-1 rounded-full text-xs font-medium text-slate-600">
                            {todayDateDisplay}
                        </div>
                    </header>

                    {/* Main Content */}
                    <main className="flex-1 p-5">
                        {view === 'track' && (
                            <div className="space-y-6 animate-fade-in">
                                {/* Overview Card */}
                                <div className="bg-white rounded-2xl p-5 shadow-sm border border-slate-100">
                                    <div className="flex items-center justify-between mb-4">
                                        <div className="flex items-center gap-2">
                                            <Icons.Activity />
                                            <h2 className="text-lg font-bold text-slate-800">Today's Overview</h2>
                                        </div>
                                    </div>

                                    {/* Net Calories Summary */}
                                    <div className="flex justify-between items-center mb-5 bg-slate-50 p-3 rounded-xl border border-slate-100">
                                        <div className="text-center">
                                            <div className="text-xs text-slate-400 font-semibold uppercase">In</div>
                                            <div className="text-sm font-bold text-slate-700">{totals.calories}</div>
                                        </div>
                                        <div className="text-slate-300">-</div>
                                        <div className="text-center">
                                            <div className="text-xs text-slate-400 font-semibold uppercase">Out</div>
                                            <div className="text-sm font-bold text-orange-500">{totals.burnt}</div>
                                        </div>
                                        <div className="text-slate-300">=</div>
                                        <div className="text-center">
                                            <div className="text-xs text-slate-400 font-semibold uppercase">Net</div>
                                            <div className="text-lg font-black text-indigo-600">{totals.calories - totals.burnt}</div>
                                        </div>
                                    </div>
                                    
                                    <ProgressBar label="Food Intake" current={totals.calories} max={goals.calories} unit="kcal" color="bg-indigo-500" />
                                    
                                    <div className="grid grid-cols-2 gap-4 mt-2">
                                        <ProgressBar label="Protein" current={totals.protein} max={goals.protein} color="bg-blue-500" />
                                        <ProgressBar label="Carbs" current={totals.carbs} max={goals.carbs} color="bg-emerald-500" />
                                    </div>
                                    <ProgressBar label="Fat" current={totals.fat} max={goals.fat} color="bg-amber-500" />
                                </div>

                                {/* Log Input */}
                                <div className="bg-white rounded-2xl p-5 shadow-sm border border-slate-100 transition-all">
                                    <div className="flex justify-between items-center mb-3">
                                        <h3 className="text-sm font-semibold text-slate-500">Log Meal</h3>
                                        <button 
                                            onClick={() => setIsCustomFood(!isCustomFood)}
                                            className="text-xs font-medium text-indigo-600 bg-indigo-50 px-2 py-1 rounded hover:bg-indigo-100 transition-colors"
                                        >
                                            {isCustomFood ? 'Search Database' : '+ Custom Entry'}
                                        </button>
                                    </div>
                                    
                                    <form onSubmit={handleAddFood} className="flex flex-col gap-3">
                                        
                                        {!isCustomFood ? (
                                            /* Standard Database Entry */
                                            <div className="flex gap-2 items-center">
                                                <div className="flex-1 min-w-0">
                                                    <select 
                                                        value={selectedFoodId}
                                                        onChange={(e) => { setSelectedFoodId(e.target.value); setAmount(''); }}
                                                        className="w-full bg-slate-50 border border-slate-200 text-slate-800 text-sm rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 block p-3 outline-none"
                                                    >
                                                        {FOOD_DATABASE.map(f => (
                                                            <option key={f.id} value={f.id}>{f.name}</option>
                                                        ))}
                                                    </select>
                                                </div>
                                                <div className="w-24">
                                                    <input 
                                                        type="number" 
                                                        value={amount}
                                                        onChange={(e) => setAmount(e.target.value)}
                                                        placeholder={selectedFood?.servingSize}
                                                        className="bg-slate-50 border border-slate-200 text-slate-800 text-sm rounded-xl focus:ring-2 focus:ring-indigo-500 block w-full p-3 outline-none text-center"
                                                    />
                                                </div>
                                            </div>
                                        ) : (
                                            /* Custom Entry Form */
                                            <div className="space-y-3 animate-fade-in">
                                                <input 
                                                    type="text" 
                                                    placeholder="Food Name (e.g. Burger)" 
                                                    value={customFood.name}
                                                    onChange={(e) => setCustomFood({...customFood, name: e.target.value})}
                                                    className="w-full bg-slate-50 border border-slate-200 text-slate-800 text-sm rounded-xl p-3 outline-none focus:ring-2 focus:ring-indigo-500"
                                                />
                                                <div className="grid grid-cols-4 gap-2">
                                                    <input type="number" placeholder="Cals" value={customFood.calories} onChange={(e) => setCustomFood({...customFood, calories: e.target.value})} className="bg-slate-50 border border-slate-200 rounded-xl p-2 text-sm text-center outline-none focus:ring-2 focus:ring-indigo-500"/>
                                                    <input type="number" placeholder="Prot" value={customFood.protein} onChange={(e) => setCustomFood({...customFood, protein: e.target.value})} className="bg-slate-50 border border-slate-200 rounded-xl p-2 text-sm text-center outline-none focus:ring-2 focus:ring-blue-500"/>
                                                    <input type="number" placeholder="Carb" value={customFood.carbs} onChange={(e) => setCustomFood({...customFood, carbs: e.target.value})} className="bg-slate-50 border border-slate-200 rounded-xl p-2 text-sm text-center outline-none focus:ring-2 focus:ring-emerald-500"/>
                                                    <input type="number" placeholder="Fat" value={customFood.fat} onChange={(e) => setCustomFood({...customFood, fat: e.target.value})} className="bg-slate-50 border border-slate-200 rounded-xl p-2 text-sm text-center outline-none focus:ring-2 focus:ring-amber-500"/>
                                                </div>
                                            </div>
                                        )}

                                        <button 
                                            type="submit" 
                                            disabled={!isCustomFood && !amount}
                                            className="w-full bg-indigo-600 hover:bg-indigo-700 text-white p-3 rounded-xl transition-colors disabled:opacity-50 disabled:cursor-not-allowed font-medium flex items-center justify-center gap-2"
                                        >
                                            <Icons.Plus /> {isCustomFood ? 'Add Custom Food' : 'Add to Log'}
                                        </button>
                                    </form>
                                    
                                    {!isCustomFood && (
                                        <div className="text-xs text-slate-400 mt-2 text-center">
                                            Serving size: {selectedFood.servingSize}{selectedFood.unit} &bull; {selectedFood.calories} kcal
                                        </div>
                                    )}
                                </div>

                                {/* Entries List */}
                                <div>
                                    <h3 className="text-xs font-bold text-slate-400 uppercase tracking-wider mb-3 ml-1">Today's Entries</h3>
                                    {todayLogs.length === 0 ? (
                                        <div className="text-center py-12 text-slate-400 italic font-light">
                                            No food logged today yet.
                                        </div>
                                    ) : (
                                        <div className="space-y-3 pb-24">
                                            {todayLogs.map(log => (
                                                <div key={log.id} className="bg-white p-4 rounded-xl shadow-sm border border-slate-100 flex justify-between items-center">
                                                    <div>
                                                        <div className="font-semibold text-slate-700 flex items-center gap-2">
                                                            {log.foodName}
                                                            {log.isCustom && <span className="bg-purple-100 text-purple-600 text-[10px] px-1.5 rounded">Custom</span>}
                                                        </div>
                                                        <div className="text-xs text-slate-500 mt-1">
                                                            {log.amount}{log.unit} &bull; <span className="text-indigo-600 font-medium">{log.calories} kcal</span>
                                                        </div>
                                                    </div>
                                                    <button 
                                                        onClick={() => setLogs(logs.filter(l => l.id !== log.id))}
                                                        className="text-slate-300 hover:text-red-500 p-2"
                                                    >
                                                        <Icons.Trash />
                                                    </button>
                                                </div>
                                            ))}
                                        </div>
                                    )}
                                </div>
                            </div>
                        )}

                        {view === 'burn' && (
                            <div className="space-y-6 pb-24">
                                <div className="bg-white p-6 rounded-2xl shadow-sm border border-slate-100">
                                    <h2 className="text-lg font-bold text-slate-800 mb-4 flex items-center gap-2">
                                        <Icons.Fire /> Log Activity
                                    </h2>
                                    <form onSubmit={handleAddExercise} className="space-y-4">
                                        <div>
                                            <label className="block text-xs font-bold uppercase text-slate-500 mb-1">Activity Name</label>
                                            <input 
                                                type="text"
                                                placeholder="e.g. Gym, Running, Walk"
                                                value={activityName}
                                                onChange={(e) => setActivityName(e.target.value)}
                                                className="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-indigo-500 outline-none"
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-xs font-bold uppercase text-slate-500 mb-1">Calories Burnt</label>
                                            <input 
                                                type="number"
                                                placeholder="kcal"
                                                value={caloriesBurnt}
                                                onChange={(e) => setCaloriesBurnt(e.target.value)}
                                                className="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-indigo-500 outline-none"
                                            />
                                        </div>
                                        <button 
                                            type="submit"
                                            disabled={!activityName || !caloriesBurnt}
                                            className="w-full bg-orange-500 hover:bg-orange-600 text-white p-3 rounded-xl transition-colors font-medium"
                                        >
                                            Log Burn
                                        </button>
                                    </form>
                                    <p className="text-xs text-slate-400 text-center mt-2">
                                        (Daily base burn of {BASE_BURN}kcal is automatically included in totals)
                                    </p>
                                </div>

                                <div>
                                    <h3 className="text-xs font-bold text-slate-400 uppercase tracking-wider mb-3 ml-1">Today's Activities</h3>
                                    {todayExercises.length === 0 ? (
                                        <div className="text-center py-10 text-slate-400 italic font-light">
                                            No activity logged today.
                                        </div>
                                    ) : (
                                        <div className="space-y-3">
                                            {todayExercises.map(ex => (
                                                <div key={ex.id} className="bg-white p-4 rounded-xl shadow-sm border border-slate-100 flex justify-between items-center">
                                                    <div>
                                                        <div className="font-semibold text-slate-700">{ex.name}</div>
                                                        <div className="text-xs text-orange-500 font-bold mt-1">
                                                            -{ex.calories} kcal
                                                        </div>
                                                    </div>
                                                    <button 
                                                        onClick={() => setExercises(exercises.filter(e => e.id !== ex.id))}
                                                        className="text-slate-300 hover:text-red-500 p-2"
                                                    >
                                                        <Icons.Trash />
                                                    </button>
                                                </div>
                                            ))}
                                        </div>
                                    )}
                                </div>
                            </div>
                        )}

                        {view === 'history' && (
                            <div className="space-y-4 pb-24">
                                <h2 className="text-lg font-bold text-slate-800 mb-4 px-1">History</h2>
                                
                                {Object.entries(logs.reduce((acc, log) => {
                                    if (!acc[log.date]) acc[log.date] = { logs: [], exercise: [] };
                                    acc[log.date].logs.push(log);
                                    return acc;
                                }, exercises.reduce((acc, ex) => {
                                    // Merge exercises into same history structure
                                    if (!acc[ex.date]) acc[ex.date] = { logs: [], exercise: [] };
                                    acc[ex.date].exercise.push(ex);
                                    return acc;
                                }, {}))).sort((a, b) => b[0].localeCompare(a[0])) 
                                .map(([date, data]) => {
                                    const dayFood = data.logs.reduce((acc, log) => ({
                                        cals: acc.cals + log.calories,
                                        prot: acc.prot + log.protein,
                                        carbs: acc.carbs + log.carbs,
                                        fat: acc.fat + log.fat
                                    }), { cals: 0, prot: 0, carbs: 0, fat: 0 });

                                    // Calculate day burn: BASE_BURN + exercises
                                    const dayBurn = data.exercise.reduce((acc, ex) => acc + ex.calories, BASE_BURN);

                                    return (
                                        <div key={date} className="bg-white p-4 rounded-xl shadow-sm border border-slate-100">
                                            <div className="flex justify-between items-center mb-3">
                                                <div className="font-bold text-slate-700">{date === getLocalISODate() ? 'Today' : date}</div>
                                                <div className="text-right">
                                                    <div className="text-sm font-bold text-indigo-600">Net: {dayFood.cals - dayBurn} kcal</div>
                                                    <div className="text-[10px] text-slate-400">
                                                        In: {dayFood.cals} | Out: {dayBurn}
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <div className="flex gap-2 mb-3">
                                                <span className="flex-1 bg-blue-50 text-blue-700 text-xs py-1 px-2 rounded text-center">
                                                    <b>P:</b> {Math.round(dayFood.prot)}g
                                                </span>
                                                <span className="flex-1 bg-emerald-50 text-emerald-700 text-xs py-1 px-2 rounded text-center">
                                                    <b>C:</b> {Math.round(dayFood.carbs)}g
                                                </span>
                                                <span className="flex-1 bg-amber-50 text-amber-700 text-xs py-1 px-2 rounded text-center">
                                                    <b>F:</b> {Math.round(dayFood.fat)}g
                                                </span>
                                            </div>
                                        </div>
                                    );
                                })}
                                
                                {logs.length === 0 && exercises.length === 0 && (
                                    <div className="text-center text-slate-400 py-10">No history found. Start logging!</div>
                                )}
                            </div>
                        )}

                        {view === 'foods' && (
                            <div className="space-y-4 pb-24">
                                <h2 className="text-lg font-bold text-slate-800 mb-4 px-1">Food Database</h2>
                                {FOOD_DATABASE.map(food => (
                                    <div key={food.id} className="bg-white p-4 rounded-xl shadow-sm border border-slate-100">
                                        <div className="flex justify-between items-start mb-2">
                                            <h3 className="font-semibold text-slate-700">{food.name}</h3>
                                            <span className="text-xs bg-indigo-50 text-indigo-600 px-2 py-1 rounded-md font-medium">
                                                {food.calories} kcal
                                            </span>
                                        </div>
                                        <div className="grid grid-cols-4 gap-2 text-xs text-slate-500">
                                            <div className="text-center bg-slate-50 p-1 rounded">
                                                <div className="font-medium text-slate-700">{food.servingSize}{food.unit}</div>
                                                <div className="text-[10px]">Serve</div>
                                            </div>
                                            <div className="text-center bg-blue-50 p-1 rounded">
                                                <div className="font-medium text-blue-700">{food.protein}g</div>
                                                <div className="text-[10px]">Prot</div>
                                            </div>
                                            <div className="text-center bg-emerald-50 p-1 rounded">
                                                <div className="font-medium text-emerald-700">{food.carbs}g</div>
                                                <div className="text-[10px]">Carb</div>
                                            </div>
                                            <div className="text-center bg-amber-50 p-1 rounded">
                                                <div className="font-medium text-amber-700">{food.fat}g</div>
                                                <div className="text-[10px]">Fat</div>
                                            </div>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        )}

                        {view === 'weight' && (
                            <div className="space-y-6 pb-24">
                                <div className="bg-white p-6 rounded-2xl shadow-sm border border-slate-100 text-center">
                                    <div className="inline-flex items-center justify-center w-12 h-12 bg-indigo-50 rounded-full text-indigo-600 mb-4">
                                        <Icons.Scale />
                                    </div>
                                    <h2 className="text-lg font-bold text-slate-800 mb-4">Log Weight</h2>
                                    <form onSubmit={handleAddWeight} className="flex gap-2 justify-center max-w-[200px] mx-auto">
                                        <input 
                                            type="number"
                                            value={currentWeight}
                                            onChange={(e) => setCurrentWeight(e.target.value)}
                                            placeholder="kg"
                                            step="0.1"
                                            className="w-full p-3 text-center text-lg bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-indigo-500 outline-none"
                                        />
                                        <button 
                                            type="submit"
                                            disabled={!currentWeight}
                                            className="px-4 bg-indigo-600 hover:bg-indigo-700 text-white rounded-xl shadow-sm transition-colors"
                                        >
                                            <Icons.Plus />
                                        </button>
                                    </form>
                                </div>

                                <div className="px-1">
                                    <h3 className="text-xs font-bold text-slate-400 uppercase tracking-wider mb-3">History</h3>
                                    <div className="bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden">
                                        {weights.length === 0 ? (
                                            <div className="p-8 text-center text-slate-400 italic font-light">No weight history yet</div>
                                        ) : (
                                            <div className="divide-y divide-slate-50">
                                                {weights.map(entry => (
                                                    <div key={entry.id} className="flex justify-between items-center p-4">
                                                        <span className="text-sm text-slate-500">{entry.date}</span>
                                                        <div className="flex items-center gap-4">
                                                            <span className="font-medium text-slate-800">{entry.weight} kg</span>
                                                            <button 
                                                                onClick={() => setWeights(weights.filter(w => w.id !== entry.id))}
                                                                className="text-slate-300 hover:text-red-500"
                                                            >
                                                                <Icons.Trash />
                                                            </button>
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                        )}
                                    </div>
                                </div>
                            </div>
                        )}

                        {view === 'goals' && (
                            <div className="space-y-6 pb-24">
                                <div className="bg-white p-6 rounded-2xl shadow-sm border border-slate-100">
                                    <h2 className="text-lg font-bold text-slate-800 mb-4 flex items-center gap-2">
                                        <Icons.Target /> Daily Goals
                                    </h2>
                                    <div className="space-y-4">
                                        {[
                                            { k: 'calories', l: 'Calories (kcal)', c: 'indigo' },
                                            { k: 'protein', l: 'Protein (g)', c: 'blue' },
                                            { k: 'carbs', l: 'Carbs (g)', c: 'emerald' },
                                            { k: 'fat', l: 'Fat (g)', c: 'amber' }
                                        ].map(({k, l, c}) => (
                                            <div key={k}>
                                                <label className={`block text-xs font-bold uppercase text-${c}-500 mb-1`}>{l}</label>
                                                <input 
                                                    type="number"
                                                    value={goals[k]}
                                                    onChange={(e) => setGoals({...goals, [k]: parseInt(e.target.value) || 0})}
                                                    className="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-indigo-500 outline-none font-medium text-slate-700"
                                                />
                                            </div>
                                        ))}
                                    </div>
                                    <p className="text-xs text-slate-400 mt-4 text-center">
                                        Changes save automatically.
                                    </p>
                                </div>
                            </div>
                        )}
                    </main>

                    {/* Bottom Nav */}
                    <BottomNav currentView={view} setView={setView} />
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>